# Photon Number Reconstruction Code
 This is the supporting code for "Number-State Tomography with a Single Single-Photon Avalanche Diode". It contains two major libraries: `PNRLib.py`, which contains all of the functions for reconstructing the input photon number distribution given a click number distribution representing an ensemble measurement of the pulse (PNR for "photon number reconstruction"), and `DCLib.py`, which contains functions for building second-order histograms (DC for "detector characterization"). The `Examples.ipynb` Jupyter notebook gives a complete example of count rate extraction and a complete example of number state reconstruction, using some sample data in the Sample Data folder. To use this code, you will want the (typically built-in) Python libraries `os`, `time`, `csv`, and in a few cases `multiprocessing`, as well as the common libraries `NumPy`, `SciPy`, `Pandas`, and `MatPlotLib`.

 We included two types of sample data: sets of pulse data for reconstruction, and sets of data from cw light to exemplify count rate extraction. The sample data is real data that is used in the paper. Specifically, the pulse data (files with the `bc_` prefix, for "binned clicks") are that used in the top rows of Fig. 2 and Fig. 4 as well as Fig. 3(a), and the cw count rate data (files with the `cw_` prefix) are points from Fig. S7(b) of the Supplemental Material.
 
 - The pulse data are formatted as NumPy arrays containing histograms of clicks as a function of (binned) time. If we denote the variable containing the entire array as `data`, then `data[0]` contains a histogram of all clicks from all runs, and then `data[n]` contains all clicks from experimental runs with exactly _n_ clicks, where _n_ is an integer going from 1 to some maximum greater than the number of clicks in any one experimental run. The user will need to do the work to process their data into a similar format.
 - The cw data are a simple list of time tags. In our particular case it was convenient to write this data with extra columns indicating a channel and a slope (rising or falling edge) for the time tag, but if the user just has a list of time tags it is easy to adapt our example notebook to that case.
 - Also included is the SPAD1 afterpulsing profile we measured during detector characterization (file `AP_Profile_SPAD1.csv`), which is used to convolve with the pulse data in the example notebook to obtain an afterpulsing probability.

# Acknowledgments

The authors thank Alessandro Restelli for helpful discussions. This material is based upon work supported by the National Science Foundation Graduate Research Fellowship Program under Grant No. DGE 1840340. Any opinions, findings, and conclusions or recommendations expressed in this material are those of the author(s) and do not necessarily reflect the views of the National Science Foundation.
